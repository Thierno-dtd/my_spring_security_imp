 input {
   beats {
     port => 5044
   }

   # Réception directe depuis l'application Spring Boot
   http {
     port => 7001
     codec => json
   }
 }

 filter {
   if [fields][log_type] == "audit" {
     mutate {
       add_tag => ["audit"]
     }
   }

   if [fields][log_type] == "security" {
     mutate {
       add_tag => ["security"]
     }

     # Enrichissement des logs de sécurité
     if [threatLevel] == "CRITICAL" {
       mutate {
         add_tag => ["alert"]
       }
     }
   }

   # Parsing des adresses IP pour géolocalisation
   if [ipAddress] {
     geoip {
       source => "ipAddress"
       target => "geoip"
     }
   }

   # Détection d'anomalies simples
   if [eventType] == "USER_LOGIN_FAILED" {
     mutate {
       add_tag => ["failed_login"]
     }
   }
 }

 output {
   elasticsearch {
     hosts => ["elasticsearch:9200"]
     index => "security-logs-%{+YYYY.MM.dd}"
   }

   # Output conditionnel pour alertes critiques
   if "alert" in [tags] {
     http {
       url => "http://your-alerting-system/webhook"
       http_method => "post"
       format => "json"
     }
   }
 }
